#!/bin/sh

ksym() {
    cat /proc/kallsyms | egrep " $1"'$' | awk '{ print $1 }'
}

echo insmod khax.ko \
    sonos_blob_encdec=0x$(ksym sonos_blob_encdec) \
    kmalloc=0x$(ksym __kmalloc) \
    kfree=0x$(ksym kfree) \
    flush_dcache_area=0x$(ksym __flush_dcache_area)

insmod khax.ko \
    sonos_blob_encdec=0x$(ksym sonos_blob_encdec) \
    kmalloc=0x$(ksym __kmalloc) \
    kfree=0x$(ksym kfree) \
    flush_dcache_area=0x$(ksym __flush_dcache_area) \

echo "[+] LKM loaded"
